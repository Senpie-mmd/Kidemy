@using Kidemy.Application.Convertors
@using Kidemy.Application.ViewModels.Course.ClientSideCourse.Comments
@using Kidemy.Application.ViewModels.Course.ClientSideCourse.CourseQuestion
@using Kidemy.Domain.Enums.Course
@using Kidemy.Domain.Shared
@using Kidemy.Domain.Statics
@model ClientSideFilterCommentsViewModel


<div class="row mb-4">
    <h5 class="mb-4">@Localizer["Comments"]</h5>

    <!-- Rating info -->
    <div class="col-md-4 mb-3 mb-md-0">
        <div class="text-center">
            <!-- Info -->
            <h2 class="mb-0">@Model?.AvrageCourseScore</h2>
            <!-- Star -->
            @Model.AvrageCourseScore
        </div>
    </div>

    <!-- Progress-bar and star -->
    <div class="col-md-8">
        <div class="row align-items-center">
            <!-- Progress bar and Rating -->
            <div class="col-6 col-sm-8">
                <!-- Progress item -->
                <div class="progress progress-sm bg-warning bg-opacity-15">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="col-6 col-sm-4">
                <!-- Star item -->
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                </ul>
            </div>

            <!-- Progress bar and Rating -->
            <div class="col-6 col-sm-8">
                <!-- Progress item -->
                <div class="progress progress-sm bg-warning bg-opacity-15">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="col-6 col-sm-4">
                <!-- Star item -->
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                </ul>
            </div>

            <!-- Progress bar and Rating -->
            <div class="col-6 col-sm-8">
                <!-- Progress item -->
                <div class="progress progress-sm bg-warning bg-opacity-15">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="col-6 col-sm-4">
                <!-- Star item -->
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                </ul>
            </div>

            <!-- Progress bar and Rating -->
            <div class="col-6 col-sm-8">
                <!-- Progress item -->
                <div class="progress progress-sm bg-warning bg-opacity-15">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="col-6 col-sm-4">
                <!-- Star item -->
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                </ul>
            </div>

            <!-- Progress bar and Rating -->
            <div class="col-6 col-sm-8">
                <!-- Progress item -->
                <div class="progress progress-sm bg-warning bg-opacity-15">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>

            <div class="col-6 col-sm-4">
                <!-- Star item -->
                <ul class="list-inline mb-0">
                    <li class="list-inline-item me-0 small"><i class="fas fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                    <li class="list-inline-item me-0 small"><i class="far fa-star text-warning"></i></li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="row">
    @foreach (var item in Model?.Entities ?? new List<ClientSideCommentViewModel>())
    {
        <div class="d-md-flex my-4">
            <div class="avatar avatar-xl me-4 flex-shrink-0">
                <img class="avatar-img rounded-circle" src="@SiteTools.UserImagePath@item.UserProfile" alt="avatar">
            </div>
            <div>
                <div class="d-sm-flex mt-1 mt-md-0 align-items-center">
                    <h5 class="me-3 mb-0 fw-normal" dir="ltr">@item.UserName</h5>
                    @*                     <ul class="list-inline mb-0">
                <li class="list-inline-item me-0"><i class="fas fa-star text-warning"></i></li>
                <li class="list-inline-item me-0"><i class="fas fa-star text-warning"></i></li>
                <li class="list-inline-item me-0"><i class="fas fa-star text-warning"></i></li>
                <li class="list-inline-item me-0"><i class="fas fa-star text-warning"></i></li>
                <li class="list-inline-item me-0"><i class="fas fa-star text-warning"></i></li>
                </ul> *@
                    @item.Score.GetEnumName()
                </div>
                <p class="small mb-2">
                    @item.CommentedDate.GetDiffreneceBetweenDateTimes()
                </p>
                <p class="mb-2">@item.Message</p>
            </div>
        </div>
    }
    <hr>
</div>

@if (User?.Identity?.IsAuthenticated ?? false)
{
    <partial name="_CreateComment" model="new ClientSideCreateCommentViewModel(){CourseSlug = Model.CourseSlug}" />
}
else
{
    <p class="alert alert-info w-100">
        @Localizer["PleaseLoginToCommentOnThisCourse"]
        <a asp-area="" asp-controller="Account" asp-action="Login" asp-route-returnUrl="@TempData["returnUrl"]" class="alert-link">@Localizer["Login"]</a>
    </p>
}

<script>
    function submitForm(formId) {
        event.preventDefault();

        var $form = $(formId);

        if ($form.valid()) {
            var formData = $form.serialize();

            $.post($form.attr('action'), formData,
                function (response) {
                    var result = response.isSuccess;
                    let resultMessage = response.message;
                    console.log(result);
                    if (result == true) {
                        location.reload();
                    }
                    else {
                        Swal.fire({
                            title: resultMessage,
                            icon: "error",
                            confirmButtonText: "باشه"
                        });
                    }
                }, 'json');
        }
    }
</script>